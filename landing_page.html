<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Welcome to SwiftCart Global Store</title>
  <meta name="description" content="Shop the best trending dropshipping products: electronics, wearables, audio, and more. Fast shipping, curated selection, and exclusive deals updated daily!">
  <meta name="keywords" content="dropshipping, trending products, electronics, wearables, audio, fast shipping, exclusive deals, online store, best gadgets, curated products, 2025">
  <meta property="og:title" content="Your Dropshipping Store - Trending Products & Fast Fulfillment" />
  <meta property="og:description" content="Shop the best trending dropshipping products: electronics, wearables, audio, and more. Fast shipping, curated selection, and exclusive deals updated daily!" />
  <meta property="og:type" content="website" />
  <meta property="og:url" content="https://yourdomain.com/" />
  <meta property="og:image" content="https://yourdomain.com/images/og-main-2025.png?v=2" />
  <meta property="og:site_name" content="Your Dropshipping Store" />
  <meta property="og:locale" content="en_US" />
  <meta name="twitter:card" content="summary_large_image" />
  <meta name="twitter:title" content="Your Dropshipping Store - Trending Products & Fast Fulfillment" />
  <meta name="twitter:description" content="Shop the best trending dropshipping products: electronics, wearables, audio, and more. Fast shipping, curated selection, and exclusive deals updated daily!" />
  <meta name="twitter:image" content="https://yourdomain.com/images/og-main-2025.png?v=2" />
  <meta name="twitter:site" content="@YourStoreHandle" />
  <meta name="twitter:creator" content="@YourStoreHandle" />
  <link rel="canonical" href="https://yourdomain.com/" />
  <link rel="icon" href="/favicon.ico" type="image/x-icon" />
  <meta name="author" content="Your Dropshipping Store Team" />
  <link href="https://cdn.jsdelivr.net/npm/tailwindcss@2.2.19/dist/tailwind.min.css" rel="stylesheet"/>
  <link rel="icon" href="/static/favicon.ico" type="image/x-icon" />
  <script type="application/ld+json">
    {
      "@context": "https://schema.org",
      "@type": "WebSite",
      "name": "Your SwiftCart Global Store",
      "url": "https://yourdomain.com/",
      "description": "Shop the best trending dropshipping products: electronics, wearables, audio, and more. Fast shipping, curated selection, and exclusive deals updated daily!",
      "publisher": {
        "@type": "Organization",
        "name": "Your SwiftCart Global Store",
        "logo": {
          "@type": "ImageObject",
          "url": "https://yourdomain.com/images/logo.png"
        }
      },
      "potentialAction": {
        "@type": "SearchAction",
        "target": "https://yourdomain.com/?search={search_term_string}",
        "query-input": "required name=search_term_string"
      }
    }
  </script>
  <script type="application/ld+json" id="product-ld-json"></script>
  <link rel="sitemap" type="application/xml" title="Sitemap" href="/sitemap.xml" />
</head>
<body class="bg-gray-50 font-sans min-h-screen flex flex-col">
  <!-- Language Toggle -->
  <div class="fixed top-2 right-2 z-50 flex gap-2">
    <button id="langEn" class="px-2 py-1 rounded bg-blue-700 text-white font-bold lang-btn" aria-label="English">EN</button>
    <button id="langZh" class="px-2 py-1 rounded bg-yellow-400 text-gray-900 font-bold lang-btn" aria-label="Chinese">ä¸­æ–‡</button>
  </div>


  <header class="relative bg-blue-600 text-white text-center" role="banner">
    <div class="relative w-full">
      <img src="/static/header.jpg" alt="SwiftCart Global Store Header" class="w-full h-56 sm:h-72 object-cover object-center" style="max-height:320px;" />
      <div class="absolute inset-0 flex flex-col justify-center items-center bg-black bg-opacity-40">
        <h1 class="text-3xl sm:text-4xl font-bold drop-shadow-lg lang-en" tabindex="0">Welcome to  SwiftCart Global Store</h1>
        <h1 class="text-3xl sm:text-4xl font-bold drop-shadow-lg lang-zh hidden" tabindex="0">æ¬¢è¿æ¥åˆ° SwiftCart å…¨çƒå•†åº—</h1>
        <p class="text-lg sm:text-xl mt-2 drop-shadow-lg lang-en" tabindex="0">Handpicked Products. Fast Fulfillment.</p>
        <p class="text-lg sm:text-xl mt-2 drop-shadow-lg lang-zh hidden" tabindex="0">ç²¾é€‰äº§å“ï¼Œæé€Ÿå‘è´§ï¼Œå…¨çƒç›´è¾¾ã€‚</p>
      </div>
      <!-- Mobile Nav Icon -->
      <button id="navToggle" class="absolute top-4 right-4 sm:hidden z-20 p-2 bg-blue-700 bg-opacity-80 rounded" aria-label="Open navigation menu">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M4 6h16M4 12h16M4 18h16"/></svg>
      </button>
    </div>
    <nav id="mainNav" class="mt-2 flex flex-col sm:flex-row justify-center items-center gap-2 sm:gap-0 bg-blue-700 bg-opacity-90 sm:bg-transparent fixed sm:static top-0 left-0 w-full sm:w-auto h-0 sm:h-auto overflow-hidden sm:overflow-visible transition-all duration-300 z-10" aria-label="Main Navigation">
      <a href="/" class="mx-2 underline" aria-label="Home">Home</a>
      <a href="/blog.html" class="mx-2 underline" aria-label="Blog">Blog</a>
      <a href="/about.html" class="mx-2 underline text-white hover:text-blue-200" aria-label="About">About</a>
      <a href="/terms.html" class="mx-2 underline text-white hover:text-blue-200" aria-label="Terms of Service">Terms</a>
      <a href="/privacy.html" class="mx-2 underline text-white hover:text-blue-200" aria-label="Privacy Policy">Privacy</a>
      <a href="/contact.html" class="mx-2 underline text-white hover:text-blue-200" aria-label="Contact">Contact</a>
      <button id="navClose" class="sm:hidden absolute top-4 right-4 p-2 bg-blue-800 rounded" aria-label="Close navigation menu" style="display:none;">
        <svg class="w-7 h-7" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M6 18L18 6M6 6l12 12"/></svg>
      </button>
    </nav>
    <script>
      const navToggle = document.getElementById('navToggle');
      const mainNav = document.getElementById('mainNav');
      const navClose = document.getElementById('navClose');
      function openNav() {
        mainNav.style.height = '18rem';
        mainNav.style.padding = '1.5rem 0';
        mainNav.style.background = 'rgba(30,64,175,0.97)';
        navClose.style.display = '';
      }
      function closeNav() {
        mainNav.style.height = '0';
        mainNav.style.padding = '0';
        mainNav.style.background = 'rgba(30,64,175,0.97)';
        navClose.style.display = 'none';
      }
      navToggle.addEventListener('click', openNav);
      navClose.addEventListener('click', closeNav);
      // Close nav on link click (mobile)
      mainNav.querySelectorAll('a').forEach(a => a.addEventListener('click', closeNav));
      // On resize, reset nav for desktop
      window.addEventListener('resize', () => {
        if(window.innerWidth >= 640) {
          mainNav.style.height = 'auto';
          mainNav.style.padding = '0';
          navClose.style.display = 'none';
        } else {
          closeNav();
        }
      });
    </script>
  </header>

  <main class="max-w-7xl mx-auto py-8 px-4" role="main">
    <h2 class="text-2xl font-semibold mb-6 text-center sm:text-left" tabindex="0">Featured Products</h2>
    <h2 class="text-2xl font-semibold mb-6 text-center sm:text-left lang-en" tabindex="0">Featured Products</h2>
    <h2 class="text-2xl font-semibold mb-6 text-center sm:text-left lang-zh hidden" tabindex="0">ç‰¹è‰²äº§å“æ¨è</h2>
    <form id="filterForm" class="flex flex-nowrap sm:flex-wrap gap-4 mb-8 overflow-x-auto pb-2" aria-label="Product Filter" style="-webkit-overflow-scrolling: touch;">
      <!-- Search Card -->
      <div class="w-full sm:w-1/4 bg-gradient-to-br from-pink-200 via-purple-200 to-blue-200 rounded-xl shadow-lg p-4 flex flex-col items-center justify-center min-h-[110px]">
        <label for="search" class="block text-lg font-semibold text-gray-800 mb-2">ğŸ” Search</label>
        <label for="search" class="block text-lg font-semibold text-gray-800 mb-2 lang-en">ğŸ” Search</label>
        <label for="search" class="block text-lg font-semibold text-gray-800 mb-2 lang-zh hidden">ğŸ” æœç´¢</label>
        <input type="text" id="search" placeholder="Search products..." class="p-2 border-2 border-pink-400 rounded w-full focus:ring-2 focus:ring-pink-400 bg-white text-gray-900" aria-label="Search products" />
      </div>
      <!-- Category Card -->
      <div class="w-full sm:w-1/4 bg-gradient-to-br from-green-200 via-teal-200 to-cyan-200 rounded-xl shadow-lg p-4 flex flex-col items-center justify-center min-h-[110px]">
        <label for="category" class="block text-lg font-semibold text-gray-800 mb-2">ğŸ—‚ï¸ Category</label>
        <label for="category" class="block text-lg font-semibold text-gray-800 mb-2 lang-en">ğŸ—‚ï¸ Category</label>
        <label for="category" class="block text-lg font-semibold text-gray-800 mb-2 lang-zh hidden">ğŸ—‚ï¸ åˆ†ç±»</label>
        <select id="category" multiple class="p-2 border-2 border-teal-400 rounded w-full h-24 focus:ring-2 focus:ring-teal-400 bg-white text-gray-900" aria-label="Category">
          <!-- Options will be populated dynamically -->
        </select>
      </div>
      <!-- Price Card -->
      <div class="w-full sm:w-1/4 bg-gradient-to-br from-yellow-200 via-orange-200 to-pink-200 rounded-xl shadow-lg p-4 flex flex-col items-center justify-center min-h-[110px]">
        <label class="block text-lg font-semibold text-gray-800 mb-2">ğŸ’² Price</label>
        <label class="block text-lg font-semibold text-gray-800 mb-2 lang-en">ğŸ’² Price</label>
        <label class="block text-lg font-semibold text-gray-800 mb-2 lang-zh hidden">ğŸ’² ä»·æ ¼åŒºé—´</label>
        <div class="flex gap-2 w-full">
          <input type="number" id="minPrice" placeholder="Min" class="p-2 border-2 border-yellow-400 rounded w-1/2 focus:ring-2 focus:ring-yellow-400 bg-white text-gray-900" aria-label="Minimum Price" />
          <input type="number" id="maxPrice" placeholder="Max" class="p-2 border-2 border-yellow-400 rounded w-1/2 focus:ring-2 focus:ring-yellow-400 bg-white text-gray-900" aria-label="Maximum Price" />
        </div>
      </div>
      <!-- Sort Card -->
      <div class="w-full sm:w-1/4 bg-gradient-to-br from-blue-200 via-indigo-200 to-purple-200 rounded-xl shadow-lg p-4 flex flex-col items-center justify-center min-h-[110px]">
        <label for="sort" class="block text-lg font-semibold text-gray-800 mb-2">â†•ï¸ Sort By</label>
        <label for="sort" class="block text-lg font-semibold text-gray-800 mb-2 lang-en">â†•ï¸ Sort By</label>
        <label for="sort" class="block text-lg font-semibold text-gray-800 mb-2 lang-zh hidden">â†•ï¸ æ’åºæ–¹å¼</label>
        <select id="sort" class="p-2 border-2 border-indigo-400 rounded w-full focus:ring-2 focus:ring-indigo-400 bg-white text-gray-900" aria-label="Sort By">
          <option value="">Sort By</option>
          <option value="price_asc">Price: Low to High</option>
          <option value="price_desc">Price: High to Low</option>
          <option value="alpha_asc">Name: A-Z</option>
          <option value="alpha_desc">Name: Z-A</option>
        </select>
      </div>
      <!-- Filter Button -->
      <div class="w-full flex justify-end mt-2">
        <button type="submit" class="bg-gradient-to-r from-green-400 to-blue-500 text-white py-2 px-8 rounded-full shadow-lg hover:from-green-500 hover:to-blue-600 font-bold text-lg transition" aria-label="Apply Filters">Filter</button>
        <button type="submit" class="bg-gradient-to-r from-green-400 to-blue-500 text-white py-2 px-8 rounded-full shadow-lg hover:from-green-500 hover:to-blue-600 font-bold text-lg transition lang-en" aria-label="Apply Filters">Filter</button>
        <button type="submit" class="bg-gradient-to-r from-green-400 to-blue-500 text-white py-2 px-8 rounded-full shadow-lg hover:from-green-500 hover:to-blue-600 font-bold text-lg transition lang-zh hidden" aria-label="Apply Filters">ç­›é€‰</button>
      </div>
    </form>

    <div id="spinner" class="flex justify-center items-center my-8 hidden">
      <svg class="animate-spin h-10 w-10 text-blue-600" xmlns="http://www.w3.org/2000/svg" fill="none" viewBox="0 0 24 24">
        <circle class="opacity-25" cx="12" cy="12" r="10" stroke="currentColor" stroke-width="4"></circle>
        <path class="opacity-75" fill="currentColor" d="M4 12a8 8 0 018-8v4a4 4 0 00-4 4H4z"></path>
      </svg>
    </div>

    <div id="errorMsg" class="hidden text-center text-red-600 bg-red-100 border border-red-300 rounded p-3 mb-4"></div>
    <div id="errorMsgZh" class="hidden text-center text-red-600 bg-red-100 border border-red-300 rounded p-3 mb-4 lang-zh">åŠ è½½äº§å“æ—¶å‡ºé”™ï¼Œè¯·ç¨åå†è¯•ã€‚</div>

    <div id="products" class="grid grid-cols-1 xs:grid-cols-1 sm:grid-cols-2 md:grid-cols-3 gap-6" aria-live="polite"></div>
    <div id="pagination" class="flex justify-center mt-8 gap-2"></div>
    <!-- Product Details Modal -->
    <div id="productModal" class="fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 hidden">
      <div class="bg-white rounded-lg shadow-lg max-w-md w-full p-6 relative">
        <button id="closeModal" class="absolute top-2 right-2 text-gray-500 hover:text-gray-800 text-2xl">&times;</button>
        <img id="modalImage" src="" alt="" class="w-full h-64 object-cover rounded mb-4">
        <h3 id="modalTitle" class="text-2xl font-bold mb-2"></h3>
        <p id="modalPrice" class="text-green-600 font-bold text-lg mb-3"></p>
        <p id="modalDescription" class="text-gray-700 mb-4"></p>
        <div id="modalExtra" class="text-sm text-gray-600 mb-4"></div>
        <a id="modalLink" href="#" target="_blank" class="bg-green-600 text-white py-2 px-4 rounded hover:bg-green-700 transition block text-center">Buy Now</a>
      </div>
    </div>
  </main>

  <footer class="bg-blue-600 text-white p-4 text-center" role="contentinfo">
    <span class="lang-en">&copy; 2025 Your Dropshipping Store. All rights reserved.</span>
    <span class="lang-zh hidden">&copy; 2025 æ‚¨çš„è·¨å¢ƒç”µå•†åº—é“ºã€‚ä¿ç•™æ‰€æœ‰æƒåˆ©ã€‚</span>
    // Language toggle logic
    function setLang(lang) {
      document.querySelectorAll('.lang-en').forEach(el => el.classList.toggle('hidden', lang !== 'en'));
      document.querySelectorAll('.lang-zh').forEach(el => el.classList.toggle('hidden', lang !== 'zh'));
      localStorage.setItem('lang', lang);
    }
    document.getElementById('langEn').addEventListener('click', () => setLang('en'));
    document.getElementById('langZh').addEventListener('click', () => setLang('zh'));
    // On load, set language from localStorage or default to English
    setLang(localStorage.getItem('lang') || 'en');
  </footer>

  <script>
    const container = document.getElementById('products');
    const sortSelect = document.getElementById('sort');
    const pagination = document.getElementById('pagination');
    const modal = document.getElementById('productModal');
    const closeModal = document.getElementById('closeModal');
    const modalImage = document.getElementById('modalImage');
    const modalTitle = document.getElementById('modalTitle');
    const modalPrice = document.getElementById('modalPrice');
    const modalDescription = document.getElementById('modalDescription');
    const modalLink = document.getElementById('modalLink');
    let currentPage = 1;
    const pageSize = 6;
    let lastQuery = '';
    let lastProducts = [];

    function renderPagination(totalPages) {
      pagination.innerHTML = '';
      if (totalPages <= 1) return;
      for (let i = 1; i <= totalPages; i++) {
        const btn = document.createElement('button');
        btn.textContent = i;
        btn.className = `px-3 py-1 rounded ${i === currentPage ? 'bg-blue-600 text-white' : 'bg-white text-blue-600 border border-blue-600'} hover:bg-blue-700 hover:text-white`;
        btn.onclick = () => {
          currentPage = i;
          renderProducts(lastProducts);
        };
        pagination.appendChild(btn);
      }
    }

    function showModal(product) {
      modalImage.src = product.image;
      modalTitle.textContent = product.title;
      modalPrice.textContent = `$${product.price}`;
      modalLink.href = product.url;
      modalDescription.textContent = product.description || 'No description available.';
      // Add brand, rating, and stock to modal
      let details = '';
      if (product.brand) details += `Brand: <span class="font-semibold">${product.brand}</span><br>`;
      if (product.rating) details += `Rating: <span class="font-semibold">${product.rating} â­</span><br>`;
      if (product.stock) details += `Stock: <span class="font-semibold">${product.stock}</span>`;
      document.getElementById('modalExtra').innerHTML = details;
      modal.classList.remove('hidden');
    }

    closeModal.addEventListener('click', () => {
      modal.classList.add('hidden');
    });
    modal.addEventListener('click', (e) => {
      if (e.target === modal) modal.classList.add('hidden');
    });

    // Highlight search matches in a string
    function highlight(text, term) {
      if (!term) return text;
      const re = new RegExp(`(${term.replace(/[.*+?^${}()|[\]\\]/g, '\\$&')})`, 'gi');
      return text.replace(re, '<mark class="bg-yellow-200">$1</mark>');
    }

    // Instant search: trigger search on input
    document.getElementById('search').addEventListener('input', function() {
      document.getElementById('filterForm').dispatchEvent(new Event('submit'));
    });

    // Helper: Remove Chinese characters from a string
    function removeChinese(text) {
      if (!text) return '';
      return text.replace(/[\u4e00-\u9fff]+/g, '').replace(/\[\".*?\"\]/g, '').replace(/,+/g, ',').replace(/^,|,$/g, '').trim();
    }

    function renderProducts(products) {
      const sort = sortSelect.value;
      if (sort === 'price_asc') {
        products.sort((a, b) => parseFloat(a.price) - parseFloat(b.price));
      } else if (sort === 'price_desc') {
        products.sort((a, b) => parseFloat(b.price) - parseFloat(a.price));
      } else if (sort === 'alpha_asc') {
        products.sort((a, b) => a.title.localeCompare(b.title));
      } else if (sort === 'alpha_desc') {
        products.sort((a, b) => b.title.localeCompare(a.title));
      }
      const totalPages = Math.ceil(products.length / pageSize) || 1;
      if (currentPage > totalPages) currentPage = totalPages;
      const start = (currentPage - 1) * pageSize;
      const end = start + pageSize;
      const pageProducts = products.slice(start, end);
      container.innerHTML = "";
      const searchTerm = document.getElementById('search').value.trim();
      pageProducts.forEach((p, idx) => {
        const productDiv = document.createElement('div');
        // Stock badge color
        let stockBadge = '';
        if (p.stock) {
          let badgeColor = 'bg-green-100 text-green-800';
          if (p.stock.toLowerCase().includes('limited')) badgeColor = 'bg-yellow-100 text-yellow-800';
          if (p.stock.toLowerCase().includes('out')) badgeColor = 'bg-red-100 text-red-800';
          stockBadge = `<span class="inline-block px-2 py-1 text-xs font-semibold rounded ${badgeColor} mb-2">${p.stock}</span>`;
        }
        // Category badge
        let categoryBadge = p.category ? `<span class="inline-block px-2 py-1 text-xs font-semibold rounded bg-blue-100 text-blue-800 mb-2 ml-2">${p.category}</span>` : '';
        // Shipping badge
        let shippingBadge = p.shipping ? `<span class="inline-block px-2 py-1 text-xs font-semibold rounded bg-purple-100 text-purple-800 mb-2 ml-2">${p.shipping}</span>` : '';
        // Rating stars
        let ratingStars = '';
        if (p.rating) {
          const rating = Math.round(parseFloat(p.rating));
          ratingStars = '<span class="text-yellow-400">' + 'â˜…'.repeat(rating) + '</span>' + '<span class="text-gray-300">' + 'â˜…'.repeat(5-rating) + '</span>';
        }
        // Remove Chinese from description for global users
        let cleanDesc = removeChinese(p.description ? p.description.substring(0, 60) + (p.description.length > 60 ? '...' : '') : '');
        productDiv.className = "bg-gradient-to-br from-pink-100 via-yellow-100 to-green-100 rounded-2xl shadow-xl overflow-hidden cursor-pointer hover:shadow-2xl transition border-2 border-yellow-200";
        productDiv.innerHTML = `
            <div class='relative'>
              <img src='${p.image}' alt='${highlight(p.title, searchTerm)}' class='w-full h-48 object-cover rounded-t-2xl border-b-2 border-yellow-100'>
              <div class='absolute top-2 left-2 flex flex-wrap'>${stockBadge}${categoryBadge}${shippingBadge}</div>
            </div>
            <div class='p-4 flex flex-col justify-between min-h-[210px]'>
              <h3 class='text-xl font-extrabold mb-1 flex items-center text-pink-800 drop-shadow'>${highlight(p.title, searchTerm)}</h3>
              <div class='flex items-center mb-2'>
                ${ratingStars}
                <span class='ml-2 text-yellow-700 text-xs'>${p.rating ? p.rating : ''}</span>
              </div>
              <p class='text-green-700 font-extrabold text-lg mb-1'>$${p.price}</p>
              <p class='text-gray-900 text-sm mb-1'>${p.brand ? 'Brand: <span class="font-semibold">' + highlight(p.brand, searchTerm) + '</span>' : ''}</p>
              <p class='text-gray-900 text-sm mb-2'>${cleanDesc}</p>
              <a href='${p.url}' target='_blank' class='relative group bg-gradient-to-r from-green-500 via-blue-500 to-purple-600 text-white py-3 px-6 rounded-full shadow-xl font-extrabold text-lg tracking-wide text-center transition-all duration-200 border-2 border-white hover:from-green-600 hover:to-purple-700 hover:scale-105 focus:outline-none focus:ring-4 focus:ring-blue-300'>
                <span class="inline-flex items-center gap-2">
                  <svg class="w-5 h-5 text-white opacity-80 group-hover:scale-110 transition-transform" fill="none" stroke="currentColor" stroke-width="2" viewBox="0 0 24 24"><path stroke-linecap="round" stroke-linejoin="round" d="M3 3h2l.4 2M7 13h10l4-8H5.4M7 13l-1.35 2.7A2 2 0 0 0 7.48 19h9.04a2 2 0 0 0 1.83-1.3L21 13M7 13V6a1 1 0 0 1 1-1h5a1 1 0 0 1 1 1v7"/></svg>
                  Buy Now
                </span>
                <span class="absolute -right-3 -top-3 bg-yellow-400 text-yellow-900 text-xs font-bold px-2 py-1 rounded-full shadow group-hover:bg-yellow-500 group-hover:text-yellow-950 transition-all">Hot</span>
              </a>
            </div>
        `;
        productDiv.addEventListener('click', (e) => {
          // Prevent modal on Buy Now click
          if (e.target.tagName.toLowerCase() === 'a') return;
          showModal(p);
        });
        container.appendChild(productDiv);
      });
      // Structured data for products
      const productLD = products.slice(0, 12).map(p => ({
        "@context": "https://schema.org",
        "@type": "Product",
        "name": p.title,
        "image": p.image,
        "description": p.description,
        "brand": { "@type": "Brand", "name": p.brand },
        "offers": {
          "@type": "Offer",
          "priceCurrency": "USD",
          "price": p.price,
          "availability": p.stock && p.stock.toLowerCase().includes('out') ? "https://schema.org/OutOfStock" : "https://schema.org/InStock",
          "url": p.url
        },
        "category": p.category,
        "aggregateRating": p.rating ? {
          "@type": "AggregateRating",
          "ratingValue": p.rating,
          "reviewCount": 10
        } : undefined
      }));
      document.getElementById('product-ld-json').textContent = JSON.stringify(productLD, null, 2);
      renderPagination(totalPages);
    }

    function showSpinner(show) {
      document.getElementById('spinner').classList.toggle('hidden', !show);
    }

    function showError(msg) {
      const errorDiv = document.getElementById('errorMsg');
      errorDiv.textContent = msg;
      errorDiv.classList.remove('hidden');
    }
    function hideError() {
      document.getElementById('errorMsg').classList.add('hidden');
    }

    function loadProducts(params = "") {
      hideError();
      showSpinner(true);
      fetch(`/products${params}`)
        .then(res => {
          if (!res.ok) throw new Error('Failed to fetch products.');
          return res.json();
        })
        .then(products => {
          lastProducts = products;
          currentPage = 1;
          renderProducts(products);
        })
        .catch(err => {
          showError('Could not load products. Please check your connection or CSV format.');
        })
        .finally(() => showSpinner(false));
    }

    // Dynamically populate category dropdown from CSV
    async function populateCategories() {
      const res = await fetch('/products');
      const products = await res.json();
      const categories = Array.from(new Set(products.map(p => p.category).filter(Boolean)));
      // Example grouping: Electronics, Wearables, Audio, etc.
      // For demo, group by first letter
      const grouped = {};
      categories.forEach(cat => {
        const group = cat[0].toUpperCase();
        if (!grouped[group]) grouped[group] = [];
        grouped[group].push(cat);
      });
      const catSelect = document.getElementById('category');
      catSelect.innerHTML = '';
      Object.keys(grouped).sort().forEach(group => {
        const optgroup = document.createElement('optgroup');
        optgroup.label = group;
        grouped[group].forEach(cat => {
          // Add icon based on category (simple emoji demo)
          let icon = '';
          if (cat.toLowerCase().includes('audio')) icon = 'ğŸ”Š ';
          else if (cat.toLowerCase().includes('wearable')) icon = 'âŒš ';
          else if (cat.toLowerCase().includes('electronic')) icon = 'ğŸ’» ';
          else icon = 'ğŸ“¦ ';
          const option = document.createElement('option');
          option.value = cat;
          option.innerText = icon + cat;
          optgroup.appendChild(option);
        });
        catSelect.appendChild(optgroup);
      });
    }
    populateCategories();

    document.getElementById('filterForm').addEventListener('submit', function(e) {
      e.preventDefault();
      const search = document.getElementById('search').value;
      // Multi-select: get all selected categories
      const catSelect = document.getElementById('category');
      const selectedCats = Array.from(catSelect.selectedOptions).map(opt => opt.value);
      const cat = selectedCats.join(',');
      const min = document.getElementById('minPrice').value;
      const max = document.getElementById('maxPrice').value;
      const query = `?search=${encodeURIComponent(search)}&category=${encodeURIComponent(cat)}&min_price=${min}&max_price=${max}`;
      loadProducts(query);
    });

    sortSelect.addEventListener('change', function() {
      document.getElementById('filterForm').dispatchEvent(new Event('submit'));
    });

    // Initial load
    loadProducts();
  </script>

</body>
</html>
