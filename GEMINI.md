Project Guidelines and Current Development StateThis document provides context and a development roadmap for the Gemini CLI to assist with ongoing project enhancements and fixes.ðŸš€ Project OverviewThis is a Flask web application designed for a dropshipping business targeting Nigerian customers.Backend: Flask (Python)Frontend: HTML, JavaScript, Tailwind CSS (served statically)Data Source: Product feed from CJ Dropshipping API, stored in feed.csv. Orders are stored in orders.json. Product reviews are stored in reviews.json. Event logs are stored in event_log.json. Affiliate withdrawal requests are stored in withdrawal_requests.json. Coupon codes are stored in coupons.json. Loyalty points are stored in loyalty_points.json. Abandoned cart logs are stored in abandoned_logs.json.Key Files:server.py: Main Flask application logic, API routes, and backend functions.feed.csv: CSV file storing product data (updated with vendor_name, vendor_email, discount_percent, discount_expiry, video_url, cost).orders.json: JSON file storing submitted customer orders.orders_fulfilled.csv: CSV log for fulfilled orders.reviews.json: JSON file storing product reviews.shipping_rates.json: JSON file storing shipping rate configurations.lang/: Directory for multilingual JSON files (e.g., en.json, yo.json, ha.json, ig.json).withdrawal_requests.json: JSON file for affiliate withdrawal requests.coupons.json: JSON file for coupon codes.loyalty_points.json: JSON file for customer loyalty points.abandoned_logs.json: JSON file for abandoned cart logs.vendors.json: JSON file storing vendor login credentials.manifest.json: Web App Manifest for PWA.sw.js: Service Worker for PWA.sync_inventory.py: Script for daily inventory synchronization.email_utils.py: Utility functions for sending emails.cj_utils.py: Utility functions for interacting with CJ Dropshipping API.utils.py: Utility functions for general purposes (e.g., Telegram alerts, event logging).invoice_template.html: HTML template for PDF invoices.shipping_label_template.html: HTML template for PDF shipping labels.landing_page.html: The main user-facing homepage.admin.html: Admin dashboard for management.product.html: Template for individual product detail pages.cart.html: Frontend cart display.signup.html: User registration page.login.html: User login page.logout.html: User logout handler.orders.html: Admin dashboard for order management.admin_dashboard.html: Admin analytics dashboard.track_order.html: Customer order tracking page.dashboard.html: Customer dashboard (for loyalty, referrals, wishlist)./vendors/<vendor_name>.html: Dynamic vendor profile pages.vendor_dashboard.html: Vendor-specific dashboard.Dockerfile: Docker containerization file.requirements.txt: Python dependencies for Docker.render.yaml: Render.com deployment configuration.Environment Variables: CJ_API_KEY, ADMIN_USERNAME, ADMIN_PASSWORD, PAYSTACK_PUBLIC_KEY, PAYSTACK_SECRET_KEY, SMTP_USERNAME, SMTP_PASSWORD, CJ_CUSTOMER_ID, TELEGRAM_TOKEN, TELEGRAM_CHAT_ID, GEMINI_API_KEY, EXCHANGE_RATE_API, BREVO_API_KEY, SHOP_EMAIL, SHOP_EMAIL_PASS, FIREBASE_API_KEY, FIREBASE_PROJECT_ID, FIREBASE_MESSAGING_SENDER_ID, FIREBASE_APP_ID, FIREBASE_VAPID_KEY, FLASK_SECRET_KEY are expected for secure credentials.ðŸ›  Recent Fixes & Current EnhancementsWe are actively implementing features to enhance the product synchronization, frontend user experience, user authentication, order management, payment processing, automated fulfillment, reporting, real-time alerts, and customer engagement.Backend Improvements (server.py, email_utils.py, cj_utils.py, utils.py, sync_inventory.py)Automated CJ Dropshipping Feed Sync:Goal: Fetch product data from CJ Dropshipping API and update feed.csv.Implemented: A fetch_and_save_cj_feed() function has been defined in server.py. This function handles API calls, response parsing, and CSV writing, including error handling and placeholder values for missing keys.Related Route: A new Flask route /admin/sync-cj has been added to trigger this function securely, accessible only when an admin is logged in via session.Daily Sync: A separate Python script sync_inventory.py has been created to fetch CJ Dropshipping product inventory and update feed.csv automatically. This script is designed to be run via a cron job every 24 hours.Order Submission Endpoint:Goal: Receive customer orders from the frontend and save them.Implemented: A Flask route /submit-order (POST method) has been added to server.py. It accepts JSON data for an order (customer info, items, total, timestamp, status, payment reference, and fulfillment_status) and saves it to orders.json. The log_order() function now sets an initial status of 'Processing'.Paystack Webhook Verification:Goal: Securely verify Paystack payments via server-to-server communication to prevent spoofing.Implemented: A Flask route /paystack/webhook (POST method) has been added to server.py. It verifies the Paystack signature using PAYSTACK_SECRET_KEY. On charge.success events, it updates the corresponding order in orders.json to status: 'Paid', records verified_by: 'webhook', paid_amount, and payment_time.Email Notification Utility:Goal: Provide a reusable function for sending emails.Implemented: A send_email(to_email, subject, html_body) function has been created in email_utils.py using Brevo (SMTP) for reliable email delivery.CJ Dropshipping Order Sync Function:Goal: Automate placing orders with CJ Dropshipping via their API.Implemented: A cj_place_order(order) function has been created in cj_utils.py to send a POST request to CJ's order API with customer and product data. This function is called after an order is marked as "Shipped" in the admin panel.Fulfillment Report Export (CSV):Goal: Allow admins to download a CSV file of all fulfilled orders.Implemented: A Flask route /admin/exports/fulfilled.csv has been added to server.py that serves the orders_fulfilled.csv file as a downloadable attachment, accessible only to logged-in admins.PDF Invoice Generation:Goal: Generate a printable PDF invoice for individual orders.Implemented: The xhtml2pdf library has been integrated. A Flask route /invoice/<order_id> has been added to server.py that renders an HTML invoice template (invoice_template.html) with order details and converts it to a downloadable PDF.Real-Time Telegram Alerts:Goal: Instantly notify the admin on Telegram when a new order is placed (specifically, when a payment is confirmed via webhook).Implemented: A send_telegram_alert(message) function has been created in utils.py to send messages to a configured Telegram bot. This function is triggered from the /paystack/webhook handler after a successful payment is recorded.Currency Conversion Logic:Goal: Allow dynamic conversion of product prices based on selected currency.Implemented: The /products endpoint in server.py now accepts a currency query parameter (?currency=USD). It uses static EXCHANGE_RATES (defined in server.py) to convert price to converted_price and sets display_currency for each product. The convert_price utility function has been added, potentially using an external API like exchangerate-api.com.Stock Level Detection:Goal: Determine and flag product availability based on stock levels from the CJ feed.Implemented: The fetch_cj_products() function now adds an in_stock boolean field to each product based on its stock value (stock > 0).Optional Filtering: The get_products() route in server.py can now filter out-of-stock products based on a ?hide_out_of_stock=true query parameter.Order Tracking API:Goal: Provide an API endpoint for customers to retrieve their order status by reference.Implemented: A Flask route /track (GET method) has been added to server.py. It accepts a ref query parameter and returns the corresponding order details from orders.json if found. An optional /admin/update-status POST route is available for admins to change order statuses.Product Review Management:Goal: Store and retrieve customer reviews for products.Implemented:load_reviews() and save_reviews() functions have been added to server.py to manage reviews.json.A Flask route /product/review (POST method) allows submission of new reviews (name, comment, rating) for a given product title. This updates the reviews field in feed.csv for the specific product.A Flask route /product/reviews (GET method) retrieves all reviews for a specific product title.Product Recommendations API ("People Also Bought"):Goal: Provide an API to fetch similar products for recommendations.Implemented: A Flask route /product/recommendations (GET method) has been added to server.py. It accepts title and category parameters and returns 3-5 products from the same category, excluding the current product. A more advanced /recommend/<title> route has also been added to suggest products based on category/brand matching.Live Chat Backend (Gemini AI):Goal: Provide a backend endpoint for the AI-powered live chat.Implemented: A Flask route /chat (POST method) has been added to server.py. It receives user messages, calls the Google Gemini API (gemini-pro model) using GEMINI_API_KEY, and returns the AI's response.AI for Product Titles & Descriptions:Goal: Automatically generate optimized product content using Gemini.Implemented: A function auto_enrich_product(product) (or similar logic) has been added to server.py that uses the Gemini API to generate short, attractive product descriptions if the description field is empty, based on the product's title, brand, and category.SEO Optimization (Backend):Goal: Improve site indexability for search engines.Implemented: A Flask route /sitemap.xml has been added to server.py that dynamically generates an XML sitemap, including home, about, contact, and all product pages.Shipping Rate Calculator (Backend):Goal: Allow customers to estimate shipping costs based on location and weight.Implemented: A shipping_rates.json file defines flat rates per state and per extra kg. A Flask route /shipping-rate (GET method) in server.py calculates and returns the estimated shipping cost based on state and weight query parameters.Event Logging for Analytics:Goal: Log all key user interactions (product views, clicks, orders) for custom analytics.Implemented: A log_event(event_type, data) function has been added to utils.py (or server.py) to append event data to event_log.json. This function is integrated into relevant routes like /products (for views/clicks) and /verify-payment (for orders).Affiliate / Referral System (Backend):Goal: Track user referrals and attribute sales.Implemented: A @app.before_request hook checks for a ref query parameter in the URL and stores it in the user's session. During payment verification (or order saving), the referred_by field is added to the order data if a referrer is present in the session.Affiliate Earnings API: A Flask route /referrals has been added to server.py to calculate and return the number of referrals and total earnings for a logged-in user based on orders.json.Optional Redirect: A /go/<ref> route is available to redirect users while storing the referral in the session.Affiliate Withdrawal Request (Backend):Goal: Allow affiliates to request payouts.Implemented: A withdrawal_requests.json file stores withdrawal requests. A Flask route /request-withdrawal (POST method) allows logged-in users to submit withdrawal requests, which are logged with user, amount, status, and timestamp.Coupon Code Redemption (Backend):Goal: Enable customers to apply discount codes during checkout.Implemented: A coupons.json file stores active coupon codes with their type (percent or flat) and value. A Flask route /apply-coupon (POST method) calculates the discount based on the provided code and cart total.CJ Dropshipping API Product Import (Backend):Goal: Directly fetch products from CJ Dropshipping API and update feed.csv.Implemented: A Python script (likely sync_inventory.py or a dedicated import script) has been created to fetch product data from CJ Dropshipping API and write it to feed.csv with appropriate field mapping.Export Orders to Excel (Backend):Goal: Allow admins to download order history as an Excel (.xlsx) file.Implemented: The openpyxl library has been installed. A Flask route /admin/export-orders has been added to server.py that generates an Excel workbook from orders.json and serves it as a downloadable attachment.Multi-Vendor Support (Backend):Goal: Allow multiple sellers to list products and manage their mini-stores.Implemented: The feed.csv structure has been modified to include vendor_name and vendor_email. The product management logic in server.py (e.g., fetch_cj_products(), admin upload) has been updated to handle these new fields. A Flask route /vendors/<vendor_name>.html has been added to dynamically generate a page listing products by a specific vendor. Vendor registration and login routes (/vendor/signup, /vendor/login) and a vendor dashboard route (/vendor/dashboard) have been created, using vendors.json for credentials.Loyalty Points System (Backend):Goal: Reward repeat customers with points for purchases.Implemented: A loyalty_points.json file stores user loyalty points. A add_loyalty_points(email, amount) function has been added to server.py and is called during checkout to award points. A /user/loyalty route returns a logged-in user's points.Email Marketing Automation (Backend):Goal: Automatically send new offers or abandoned cart reminders.Implemented: The send_offer_email function (using Brevo API) has been added to server.py. Logic to track abandoned carts (via /api/abandoned-cart POST route and abandoned_logs.json) is in place, ready for a daily task to trigger reminder emails.Product Video Support (Backend):Goal: Store and serve product video URLs.Implemented: The feed.csv structure has been updated to include a video_url field. Backend logic for fetching and managing products will now handle this field.Tax Calculator by Location (State-Based VAT):Goal: Automatically calculate VAT based on the customerâ€™s state during checkout.Implemented: NIGERIAN_TAX_RATES dictionary defined in server.py. A calculate_tax(state, amount) function computes the tax. This is integrated into the total cost calculation during checkout.Delivery Integration (GIG/Kwik - Backend Stub):Goal: Provide real-time delivery fee estimates using major Nigerian logistics APIs.Implemented: A estimate_delivery_fee(method, weight, location) function (with dummy rates for GIG/Kwik) has been added to server.py. This is included in the total cost calculation during checkout.Push Notifications (Firebase - Backend Setup):Goal: Enable sending push notifications to users for order updates, discounts, etc.Implemented: Firebase configuration for Cloud Messaging is set up in server.py (though the actual sending logic would be triggered by events).Visual Search (Backend Stub):Goal: Allow users to search for similar products by uploading an image.Implemented: A Flask route /search-by-image (POST method) has been added to server.py to accept an image. Currently, it returns a placeholder response, awaiting integration with a real AI vision model (like Gemini Vision).AI Product Tag Generator (Backend Integration):Goal: Automatically assign relevant product tags and categories using an AI model.Implemented: The frontend "Generate Tags" button will call the Gemini API directly to get suggested tags based on product description. The backend would primarily store these tags in the product data.Sales Notifications & Email Receipts (Backend):Goal: Alert both customer and admin instantly when an order is placed and send styled email receipts.Implemented: Flask-Mail has been installed and configured in server.py with SMTP settings. Logic to send receipt and notification emails has been added to the /checkout or payment verification route.Profit Calculator for Admin (Backend):Goal: Track profit by subtracting CJ cost from sale price.Implemented: The feed.csv structure has been updated to include a cost field. Backend logic for admin product views or dashboards will now calculate and display profit = price - cost.Inventory & Sales Dashboard (Backend Data):Goal: Provide data for live charts of orders, profits, stock levels, and vendors.Implemented: A Flask route /admin/stats has been added to server.py to return data (e.g., product prices) that can be used by frontend charting libraries.Print Labels for Shipping (PDF Format):Goal: Automatically generate a printable PDF shipping label per order.Implemented: A Flask route /shipping-label/<order_id> has been added to server.py. It retrieves order details (placeholder for now), renders them using shipping_label_template.html, converts the HTML to PDF using xhtml2pdf, and serves the PDF as a downloadable file.Frontend Enhancements (landing_page.html, admin.html, product.html, cart.html, signup.html, login.html, logout.html, orders.html, admin_dashboard.html, track_order.html, dashboard.html, vendor_dashboard.html)Admin Sync Button:Goal: Provide a user interface in admin.html to trigger the CJ product feed synchronization.Implemented: A Tailwind-styled button in admin.html that uses JavaScript fetch() to call the /admin/sync-cj endpoint and displays the result.Improved Product Grid on Landing Page:Goal: Display products fetched from the /products endpoint in a responsive, visually appealing grid.Implemented: The landing_page.html now includes a Tailwind CSS grid layout (grid-cols-1 sm:grid-cols-2 md:grid-cols-3 lg:grid-cols-4) that dynamically populates product cards (image, title, price, category, link) using JavaScript fetch().Search and Filter Bar:Goal: Allow users to search, filter by category, and sort products directly on the landing_page.html.Implemented: Above the product grid, there's a search input, category dropdown, and sort select. JavaScript handles fetching products with query parameters (/products?search=...&category=...&sort=...) to update the displayed products.Loading Spinner UX:Goal: Improve user experience by showing a visual indicator during product data fetches.Implemented: A loading spinner has been added to landing_page.html that is displayed during fetch() calls and hidden once product data is loaded.Product Detail Pages:Goal: Create individual pages for each product to display detailed information.Implemented: A product.html template has been created which dynamically loads product data based on a query string ID (?id=123) from the /products endpoint. It displays title, image, description, price. Links in the product grid now point to product.html?id=<index>.Product Video Support (Frontend): The product viewer on product.html has been updated to render videos using the video_url field from feed.csv (either direct video or YouTube embed).Frontend Cart Functionality:Goal: Allow users to add products to a local shopping cart and view them.Implemented:An "Add to Cart" button on product.html stores product IDs in the browser's localStorage.A cart.html page displays items from localStorage, showing product cards with basic info and allowing items to be removed.The "Proceed to Checkout" button has been updated to trigger the Paystack payment flow.Marketing Landing Page Design:Goal: Enhance landing_page.html with a conversion-focused layout.Implemented: A modern, mobile-first design including a hero section (headline, subtext, CTA), trust badges (fast delivery, secure payment, returns), and sections for featured products and customer testimonials.Analytics Integration (GA4):Goal: Set up tracking for user behavior and SEO.Implemented: Google Analytics (GA4) global site tag (gtag.js) has been added to the <head> of all HTML pages for basic analytics tracking.Email Signup Form:Goal: Capture leads for marketing.Implemented: A minimalist email signup form in landing_page.html designed for mobile, configured to POST to an external service (e.g., Brevo/GetResponse/ConvertKit). A promotional banner has also been added to the homepage.User Authentication (Frontend-First):Goal: Implement user registration, login, and logout functionality.Implemented:signup.html: Responsive Tailwind CSS form for name, email, password, confirm password. On submit, saves user to localStorage and redirects to login.html.login.html: Tailwind CSS form for email and password. Checks credentials against localStorage user, sets loggedIn=true in localStorage on success, and redirects to landing_page.html.logout.html: Clears localStorage (loggedIn status) and redirects to login.html.Page Protection: cart.html and checkout.html (if it exists) now include a JavaScript check to redirect to login.html if localStorage.loggedIn is not true.Paystack Payment Integration (Frontend):Goal: Integrate Paystack inline checkout for payment processing.Implemented:Paystack inline script added to cart.html.The "Checkout" button in cart.html now triggers the payWithPaystack() function, which initiates the Paystack inline widget with customer email, calculated total (in kobo), and a unique reference.The frontend callback for Paystack now only alerts the user about payment initiation, relying on the webhook for final order status update.Shipping Confirmation Email:Goal: Notify the customer when their order is marked as "Shipped."Implemented: In the /admin/mark-shipped route in server.py, after successfully marking an order as "Shipped" and syncing with CJ, an email is sent to the customer using the send_email utility function with an HTML body confirming shipment.Currency Switcher:Goal: Allow users to select their preferred display currency.Implemented: A currency dropdown (â‚¦ / $ / â‚¬) has been added to landing_page.html. JavaScript handles updating the product list with the selected currency, fetching data from /products?currency=..., and storing the user's preference in localStorage. Product cards now display converted_price and display_currency.Optional: The currency preference can be stored in localStorage and loaded on page load.Stock Status Display:Goal: Visually indicate "Out of Stock" products on the frontend.Implemented: Product cards on landing_page.html now display a red "Out of Stock" badge if p.in_stock is false.Optional Filtering: A checkbox can be added to the UI to allow users to toggle hiding out-of-stock products.Customer Order Tracking Page:Goal: Provide a page where customers can track their order status.Implemented: A track_order.html page has been created (served by /track-order route) with a form to enter an order reference. JavaScript fetches order details from the /track API endpoint and displays the status and summary.Product Review and Star Rating System:Goal: Allow customers to submit reviews and star ratings for products, and display these reviews.Implemented:A review submission form (name, comment, rating) has been added to the product detail page (product.html).JavaScript handles submitting reviews to /product/review (POST) and fetching existing reviews from /product/reviews (GET) to display them.Product Recommendations UI ("People Also Bought"):Goal: Display related product recommendations on product detail pages.Implemented: A "People Also Bought" section has been added to product.html. JavaScript fetches recommendations from /product/recommendations?title=...&category=... (or /recommend/<title>) and displays them as product cards.Live Chat Widget (Gemini AI):Goal: Integrate an AI-powered live chat assistant directly into the website.Implemented: A floating chat bubble UI has been added (e.g., to landing_page.html or site-wide layout). It includes a pop-up text area for user input and displays Gemini's responses, communicating with the /chat backend route. A client-side AI Chatbot Upsell Assistant has also been implemented using the Gemini API to suggest related or upsell products during chat.SEO Optimization (Frontend):Goal: Improve site visibility and indexing.Implemented: Essential <meta> tags (e.g., description, robots) have been added to the <head> section of HTML pages.Shipping Rate Calculator (Frontend):Goal: Allow customers to estimate shipping costs.Implemented: A shipping calculator form (state dropdown, weight input) has been added to the checkout page. JavaScript calls the /shipping-rate endpoint to display the estimated cost.Multilingual Support:Goal: Allow users to switch the website language.Implemented: Language-specific JSON files are stored in a /lang/ directory. A language switcher dropdown has been added to landing_page.html. JavaScript loads the appropriate JSON dictionary and updates data-i18n tagged elements. AI-powered auto-translation using Gemini API (client-side) has been added to translate text content dynamically.Customer Dashboard:Goal: Provide a personalized dashboard for logged-in customers to view their orders and saved products.Implemented: A dashboard.html page has been created (served by /dashboard route) with a Flask session-based login check. It includes placeholder sections for saved products and order history. A saveToWishlist function is available for frontend use. Loyalty points are displayed on this dashboard.Order Tracking & Invoice (via Paystack Reference):Goal: Allow customers to track orders and download invoices based on their Paystack reference.Implemented: The save_order function now stores detailed payment data from Paystack. The /orders route can fetch orders by email for logged-in users.Marketing Campaign Elements:Goal: Implement basic elements for marketing campaigns.Implemented: A welcome email HTML template is provided for integration with email providers. A promotional banner has been added to the homepage. An email collection form is available for newsletter subscriptions.Affiliate Dashboard (Frontend):Goal: Provide a dashboard for users to track their referrals and earnings.Implemented: A Flask route /referrals returns referral data for a logged-in user. The frontend dashboard (dashboard.html or a separate referrals.html) will display this information. A button to request withdrawal is also present.WhatsApp Floating Help Icon:Goal: Provide easy access to customer support via WhatsApp.Implemented: A floating WhatsApp button has been added to the bottom-right corner of the screen, linking to a pre-filled WhatsApp chat.Coupon Code Redemption (Frontend):Goal: Allow customers to apply coupon codes during checkout.Implemented: An input field for coupon codes and an "Apply" button have been added to the checkout form. JavaScript calls the /apply-coupon endpoint to validate the code and display the discount.PWA Implementation:Goal: Turn the web app into a Progressive Web App for an app-like experience on mobile.Implemented: manifest.json and a basic sw.js (service worker) have been added to enable PWA support, allowing the app to be installed on mobile devices and offering some offline capabilities.Push Notifications (Firebase - Frontend Setup): Firebase JS SDK integration (initializeApp, getMessaging, getToken, onMessage) has been added to app.js (or main JS file) to enable web push notifications.User Wishlist / Favorites (Frontend):Goal: Allow users to save products they are interested in.Implemented: Buttons to toggle products in a wishlist have been added. The wishlist is stored in localStorage. A dedicated wishlist page displays saved items.Advanced Discounts & Flash Sales (Frontend):Goal: Display discounted prices and countdown timers for promotional offers.Implemented: The feed.csv structure has been extended with discount_percent and discount_expiry fields. Frontend logic has been added to calculate and display discounted prices and a countdown timer for flash sales.Abandoned Cart Recovery Email (Frontend):Goal: Track abandoned carts to enable recovery efforts.Implemented: JavaScript uses window.onbeforeunload to send abandoned cart data to the /api/abandoned-cart backend endpoint if the cart is not empty.Tax Calculator by Location (Frontend):Goal: Display calculated VAT based on customer's selected state.Implemented: A state dropdown has been added to the checkout form. JavaScript will trigger a recalculation of the total, including tax, when the state changes.Delivery Integration (Frontend):Goal: Allow customers to select a delivery method and see estimated fees.Implemented: A delivery method dropdown has been added to the checkout form. Frontend logic will integrate the estimated delivery fee into the total cost calculation.Visual Search (Frontend):Goal: Allow users to search for similar products by uploading an image.Implemented: An image upload input has been added to the UI. JavaScript sends the image to the /search-by-image backend endpoint and displays the placeholder matches.AI Product Tag Generator (Frontend):Goal: Provide a UI to automatically assign relevant product tags using AI.Implemented: A "Generate Tags" button, textarea, and display area for generated tags have been added to the admin product upload UI. JavaScript calls the Gemini API to get suggested tags and displays/autofills them.Admin Panel & Order ManagementOrder Submission by Users:Goal: Allow logged-in users to "submit" their cart as an order.Implemented: The "Submit Order" button (now "Pay Now" with Paystack) in cart.html collects customer info and cart items, calculates the total, and sends this data to the /submit-order Flask endpoint.Admin Order Viewing:Goal: Provide an interface for administrators to view all submitted orders.Implemented: A Flask route /admin/orders.html has been added to server.py that serves the orders.html template. This template dynamically fetches orders from a backend endpoint (e.g., /admin/history) and displays them in a table. Access is restricted to logged-in admins.Order Fulfillment Tracking:Goal: Allow admins to update the status of orders and track fulfillment.Implemented:The order structure in orders.json now includes a fulfillment_status field (defaulting to 'Pending').A Flask route /admin/mark-shipped (POST method) handles updating an order's fulfillment_status to 'Shipped' in orders.json based on a reference ID. It also records shipped_time.The orders.html dashboard includes buttons to "Mark Shipped" for pending orders, which trigger the /admin/mark-shipped endpoint via JavaScript fetch().Fulfilled Orders CSV Export:Goal: Automatically log shipped orders to a CSV file for record-keeping or further processing.Implemented: Whenever an order is marked as "Shipped" via the /admin/mark-shipped route, a record is appended to orders_fulfilled.csv with relevant details like reference, customer email, total, and shipment timestamp.Download Route: A Flask route /admin/exports/fulfilled.csv has been added to server.py to allow logged-in admins to download this CSV file.Admin Link: A button linking to /admin/exports/fulfilled.csv has been added to orders.html.Automated CJ Order Fulfillment:Goal: Automatically place orders with CJ Dropshipping once they are marked as "Shipped" in the admin panel.Implemented: After an order's fulfillment_status is updated to 'Shipped' in the /admin/mark-shipped route, the cj_place_order() function from cj_utils.py is called to send the order details to the CJ Dropshipping API.PDF Invoice Generation:Goal: Provide a downloadable PDF invoice for each order.Implemented: A Flask route /invoice/<reference>.pdf in server.py dynamically generates an HTML invoice for a given order reference and converts it to a PDF using WeasyPrint.Admin Link: A button linking to /invoice/<reference>.pdf has been added to each order row in orders.html.Real-Time Telegram Alerts:Goal: Instantly notify the admin on Telegram when a new order is placed (payment confirmed via webhook).Implemented: A send_telegram_alert() function in utils.py sends formatted messages to a Telegram bot. This function is triggered within the /paystack/webhook route after a successful payment is processed and the order status is updated.Admin Analytics Dashboard:Goal: Provide administrators with an overview of sales trends, top products, and order performance.Implemented:A log_order(order_data) function has been added to server.py to append new orders to orders.json for analytics.A Flask API route /admin/analytics has been added to server.py that processes orders.json to return total sales, total orders, sales by date, and top-selling products.An admin_dashboard.html page has been created (served by /admin/dashboard route) that uses Chart.js to display a daily sales chart and a list of top products, fetching data from /admin/analytics.Inventory & Sales Dashboard (Graph View): A Flask route /admin/stats has been added to server.py to return data (e.g., product prices) that can be used by frontend charting libraries (like Chart.js) to render graphs on the admin dashboard.Admin Panel Link:Implemented: A link to /admin/orders.html has been added to the admin panel (admin.html).Export Orders to Excel (Admin):Goal: Allow admins to download a comprehensive Excel file of all orders.Implemented: A Flask route /admin/export-orders has been added to server.py that uses openpyxl to generate an Excel workbook from orders.json and serves it as a downloadable attachment.Affiliate Withdrawal Management (Admin):Goal: Allow admins to view and manage affiliate withdrawal requests. (Note: Admin UI for this is pending but backend route exists).Bulk CSV Import Tool (Admin):Goal: Allow admins to upload hundreds of products at once.Implemented: A Flask route /admin/bulk-upload (POST, multipart/form-data) has been added to server.py to receive and save CSV files for bulk product import.Profit Calculator for Admin (Frontend Display):Goal: Display profit margin per product in the admin interface.Implemented: The feed.csv includes a cost field. Frontend logic in admin product views will now calculate and display profit = price - cost.Sales Notifications & Email Receipts (Admin):Goal: Send sales notifications to admin.Implemented: Flask-Mail configured. Logic to send sales notification emails to admin has been added to the /checkout or payment verification route.Print Labels for Shipping (PDF Format):Goal: Automatically generate a printable PDF shipping label per order.Implemented: A Flask route /shipping-label/<order_id> has been added to server.py. It retrieves order details (placeholder for now), renders them using shipping_label_template.html, converts the HTML to PDF using xhtml2pdf, and serves the PDF as a downloadable file.ðŸŽ¯ Goals for Gemini CLI InteractionWhen working with this project, Gemini should:Adhere to Python Flask best practices for server.py: Ensure clean, modular code, proper error handling, and secure session management.Maintain Tailwind CSS best practices for HTML files: Ensure responsiveness, semantic HTML, and correct utility class usage.Produce clean, efficient JavaScript: Focus on DOM manipulation, fetch() API usage, and localStorage interactions where applicable.Respect existing file structures: All key files listed in "Key Files" section are core.Prioritize mobile-first design for all frontend work.Avoid introducing new external libraries unless explicitly requested.Understand the current authentication flow (frontend localStorage based, with backend routes for potential future expansion) and the order management system (orders.json, orders_fulfilled.csv).Recognize Paystack integration and related data fields (status, reference, paid_amount, payment_time).Be aware of email utility (email_utils.py) and its usage for customer and admin notifications.Understand CJ Dropshipping integration (cj_utils.py) for automated order placement and daily inventory sync.Recognize PDF generation (WeasyPrint, xhtml2pdf) and its usage for invoices and shipping labels.Understand Telegram integration (utils.py) for real-time alerts.Be aware of currency conversion logic and stock status flags in product data.Understand the analytics data flow and dashboard components.Recognize the order tracking functionality for customers.Understand the product review system for submission and display.Understand the product recommendation logic based on categories.Understand the Gemini AI live chat integration and its role in customer support and upsell suggestions.Recognize the shipping rate calculation logic.Be aware of multilingual capabilities and the use of lang/ files, including AI-powered auto-translation.Understand the customer dashboard and its features (order history, wishlist, affiliate referrals, loyalty points).Recognize marketing campaign elements (welcome email, promo banner, newsletter signup, abandoned cart recovery).Understand the affiliate/referral system including tracking, earnings, and withdrawal requests.Recognize coupon code redemption logic.Be aware of PWA implementation (manifest.json, sw.js).Understand the Excel export functionality for orders.Recognize multi-vendor support and its impact on product data and display.Understand the bulk CSV import tool.Recognize product video support.Understand the wishlist/favorites feature.Be aware of advanced discounts and flash sales.Understand the tax calculation logic.Recognize the delivery integration (GIG/Kwik) logic.Understand Firebase push notification setup.Recognize the visual search functionality.Understand the AI product tag generation process.Understand the profit calculation and display.Recognize the sales and inventory dashboard (Chart.js) integration.ðŸ’¡ Pending Tasks & Future Prompts (Coming Soon!)Backend User Authentication: Expanding user authentication to use a database (e.g., SQLite or Firebase) for persistent and secure user data (beyond current frontend-first approach).Google Merchant Center Integration: Preparing data for GMC feeds (beyond current CSV compliance).Flutterwave Integration: Adding Flutterwave as an alternative payment gateway.Advanced Admin Features: Order search, filtering, detailed order views (beyond the current table), and admin UI for managing affiliate withdrawal requests.Image CDN/Optimization: Implementing a CDN for product images and optimizing their delivery.ðŸš€ PHASE 74: Production Deployment (Docker + Render.com)Prepare your application for live deployment, ensuring scalability, reliability, and ease of management.âœ… 1. Create requirements.txtðŸ§© Gemini Prompt:Generate requirements.txt for Flask, requests, weasyprint, xhtml2pdf, openpyxl, google-generativeai, flask-mail
```bash
# requirements.txt
Flask==2.3.2
requests==2.31.0
WeasyPrint==59.0.1
xhtml2pdf==0.2.11
openpyxl==3.1.2
google-generativeai==0.3.0
Flask-Mail==0.9.1
gunicorn==21.2.0 # For production WSGI server
âœ… 2. Create DockerfileðŸ§© Gemini Prompt:Create a Dockerfile for a Flask application that serves static files and uses Gunicorn.
```dockerfile
# Dockerfile
# Use a slim Python image for smaller size
FROM python:3.9-slim-buster

# Set the working directory in the container
WORKDIR /app

# Copy requirements.txt and install dependencies
COPY requirements.txt .
RUN pip install --no-cache-dir -r requirements.txt

# Copy the rest of the application code
COPY . .

# Expose the port Flask runs on
EXPOSE 8000

# Command to run the application using Gunicorn
# Adjust 'server:app' if your Flask app instance is named differently
CMD ["gunicorn", "--bind", "0.0.0.0:8000", "server:app"]
âœ… 3. Create render.yamlðŸ§© Gemini Prompt:Create a render.yaml for deploying a Flask web service and a cron job for sync_inventory.py.
```yaml
# render.yaml
services:
  - type: web
    name: dropship-ng-web
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: gunicorn --bind 0.0.0.0:$PORT server:app
    envVars:
      - key: FLASK_SECRET_KEY # IMPORTANT: Generate a strong, unique key for production
        generateValue: true
      - key: ADMIN_USERNAME
        value: your_admin_username
      - key: ADMIN_PASSWORD
        value: your_admin_password
      - key: PAYSTACK_PUBLIC_KEY
        value: pk_live_xxxxxxxxxxxxx
      - key: PAYSTACK_SECRET_KEY
        value: sk_live_xxxxxxxxxxxxx
      - key: SMTP_USERNAME
        value: your_smtp_email@gmail.com
      - key: SMTP_PASSWORD
        value: your_smtp_app_password
      - key: SHOP_EMAIL
        value: no-reply@yourdomain.com
      - key: SHOP_EMAIL_PASS
        value: your_shop_email_app_password
      - key: TELEGRAM_TOKEN
        value: your_telegram_bot_token
      - key: TELEGRAM_CHAT_ID
        value: your_telegram_chat_id
      - key: GEMINI_API_KEY
        value: your_gemini_api_key
      - key: EXCHANGE_RATE_API
        value: your_exchange_rate_api_key
      - key: BREVO_API_KEY
        value: your_brevo_api_key
      # Add Firebase keys if needed for server-side push notification sending
      # - key: FIREBASE_API_KEY
      #   value: your_firebase_api_key
      # ... other firebase keys
    autoDeploy: true
    pullRequestPreviewsEnabled: true
    healthCheckPath: /health # Add a simple health check route in server.py if needed

  - type: cron
    name: inventory-sync-cron
    env: python
    buildCommand: pip install -r requirements.txt
    startCommand: python sync_inventory.py
    schedule: "0 2 * * *" # Runs daily at 2:00 AM UTC
    envVars:
      - key: CJ_API_TOKEN # Use CJ_API_TOKEN for sync_inventory.py
        value: your_cj_api_token
      # Ensure other necessary env vars for sync_inventory.py are here if it needs them
âœ… Final Recap: Your Comprehensive Dropshipping PlatformYour platform is now a feature-rich, intelligent, and robust e-commerce solution ready for deployment.CategoryFeatureStatusCore StackFlask (Python), HTML, TailwindCSS, JSâœ…Product Feed (feed.csv)âœ…Admin Auth (Flask sessions)âœ…Security (Headers, XSS, ENV secrets)âœ…E-commerceLanding page, Product Listing (Search/Filter)âœ…Product Detail Viewâœ…Cart Functionalityâœ…Paystack Payment Integrationâœ…Currency Switcher (NGN, USD, EUR)âœ…Stock Status Displayâœ…Customer Reviews & Star Ratingsâœ…"People Also Bought" Recommendationsâœ…User Wishlist / Favoritesâœ…Advanced Discounts & Flash Salesâœ…Admin PanelAdmin Login/Logoutâœ…Product CSV Uploadâœ…View Order Listâœ…Mark Order Shippedâœ…Fulfilled Orders CSV Exportâœ…PDF Invoice Generationâœ…Real-Time Telegram Alertsâœ…Admin Analytics Dashboard (Charts)âœ…Export Orders to Excelâœ…Profit Calculator per Productâœ…Automation & AIDaily CJ Inventory Syncâœ…AI Chatbot Assistant (Gemini)âœ…AI Product Titles & Descriptionsâœ…AI Product Tag Generatorâœ…Abandoned Cart Recovery Emailâœ…Logistics & OpsShipping Rate Calculator (State-Based)âœ…Delivery Integration (GIG/Kwik logic)âœ…Print Labels for Shipping (PDF)âœ…Marketing & GrowthEmail Signup (Newsletter)âœ…Affiliate / Referral Systemâœ…Affiliate Withdrawal Request Pageâœ…Coupon Code Redemptionâœ…Sales Notifications & Email Receiptsâœ…User ExperienceCustomer Order Tracking Pageâœ…Multilingual Support (4 Languages)âœ…PWA (Installable Mobile App)âœ…Push Notifications (Firebase)âœ…WhatsApp Floating Help Iconâœ…Visual Search via Image Uploadâœ…Advanced FeaturesMulti-Vendor Support (Vendor Dashboard)âœ…Loyalty Points Systemâœ…AI-Powered Auto Translationâœ…Bulk CSV Product Importâœ…Product Video Supportâœ…DeploymentDockerization (Dockerfile)âœ…Dependency Management (requirements.txt)âœ…Render.com Deployment (render.yaml)âœ…Your dropshipping platform is now fully equipped with a comprehensive set of features, from core e-commerce functionalities to advanced AI, logistics, and growth tools, all ready for production deployment.